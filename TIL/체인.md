### 리트리버의 역할
리트리버는 사용자의 질문을 **임베딩 모델**을 통해 벡터화하고, 저장소에 있는 여러 텍스트 청크 벡터들과 비교하여 **가장 유사한 벡터**들을 뽑아냅니다. 이렇게 추출된 텍스트 청크를 **컨텍스트**로 제공하고, 질문과 함께 **프롬프트**로 연결하여 **LLM**에 전달하는 역할을 합니다.

### 리트리버 관련 체인 타입
리트리버의 핵심 역할은 **컨텍스트 선택 및 전달**인데, 이를 위한 체인 타입에는 **4가지**가 있습니다. 각각의 체인 타입은 처리 방식과 효율성에 차이가 있으며, 다음과 같은 특징이 있습니다.

1. **스태프(Stuff)** 체인:
   - 가장 **단순한 방식**으로, 사용자의 질문과 관련된 문서들을 한 번에 LLM에 전달합니다.
   - 단점: **토큰 제한** 문제로, 컨텍스트가 너무 길면 LLM에 입력할 수 없는 문제가 발생할 수 있습니다.

2. **맵 리듀스(MapReduce)** 체인:
   - **병렬 처리**를 통해 각 문서에 대해 **요약**을 생성하고, 이후 그 요약들을 종합하여 최종 요약을 만들어 LLM에 전달합니다.
   - 장점: 토큰 이슈를 해결할 수 있고, 여러 문서를 압축하여 처리할 수 있습니다.
   - 단점: 각 문서에 대해 요약을 여러 번 처리해야 하므로 **시간과 비용**이 많이 듭니다.

3. **리파인(Refine)** 체인:
   - **누적 방식**으로 작업을 진행합니다. 각 문서마다 LLM을 호출하고, 그 결과를 **중간 답변**으로 저장한 후, 후속 문서들을 처리하면서 **점차적으로 품질을 높여** 최종 답변을 도출합니다.
   - 장점: 점진적으로 **품질 높은 답변**을 얻을 수 있습니다.
   - 단점: 순차적인 처리로 **시간이 많이 걸리고** 여러 번 LLM을 호출해야 하므로 효율적이지 않을 수 있습니다.

4. **맵 리랭킹(Map Reranking)** 체인:
   - 각 문서에 대해 LLM을 호출하여 답변과 **연관성 점수**(스코어)를 제공합니다. 이후 점수가 가장 높은 문서 하나를 최종 답변으로 선택합니다.
   - 장점: 가장 연관성이 높은 답변을 선택하여 **정확도 높은 결과**를 도출할 수 있습니다.
   - 단점: **시간 소요**가 크고 여러 번 LLM을 호출하는 비용 문제가 있습니다.

### 체인 선택의 중요성
- 각 체인 타입은 **효율성**과 **정확성**에서 차이가 나므로, 사용 사례에 따라 적절한 체인 타입을 선택하는 것이 중요합니다. 예를 들어, **속도**가 중요한 경우 스태프 체인, **답변 품질**이 중요한 경우 리파인 체인 등을 선택할 수 있습니다.